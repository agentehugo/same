<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAME - HOSP. DE URGÊNCIA DE GOIÁS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <!-- Google API -->
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #1abc9c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        .sidebar {
            background-color: var(--primary-color);
            color: white;
            min-height: 100vh;
            padding: 0;
            box-shadow: 3px 0 10px rgba(0,0,0,0.1);
        }
        
        .sidebar .nav-link {
            color: var(--light-color);
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .main-content {
            padding: 20px;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            padding: 15px 20px;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            border: none;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .tab-content {
            padding: 20px;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 10px 10px;
            background-color: white;
        }
        
        .dashboard-card {
            text-align: center;
            padding: 20px;
        }
        
        .dashboard-card i {
            font-size: 2.5rem;
            color: var(--secondary-color);
            margin-bottom: 15px;
        }
        
        .dashboard-card h3 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .dashboard-card p {
            color: var(--dark-color);
            margin-bottom: 0;
        }
        
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table thead {
            background-color: var(--primary-color);
            color: white;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            background-color: white;
        }
        
        .stats-card {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .action-buttons .btn {
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .hospital-header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 15px 0;
            margin-bottom: 20px;
            border-radius: 10px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }
        
        .auto-field {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        .badge {
            font-size: 0.8em;
        }
        
        /* Melhorias para responsividade */
        @media (max-width: 768px) {
            .sidebar {
                min-height: auto;
                position: fixed;
                width: 100%;
                z-index: 1000;
                height: 60px;
                overflow-y: auto;
            }
            
            .sidebar .nav-pills {
                flex-direction: row !important;
                overflow-x: auto;
            }
            
            .sidebar .nav-item {
                flex-shrink: 0;
            }
            
            .main-content {
                margin-top: 60px;
                padding: 10px;
            }
            
            .hospital-header h2 {
                font-size: 1.5rem;
            }
            
            .dashboard-card h3 {
                font-size: 1.5rem;
            }
        }
        
        /* Feedback visual para validação */
        .is-invalid {
            border-color: #dc3545;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }
        
        .invalid-feedback {
            display: block;
            width: 100%;
            margin-top: 0.25rem;
            font-size: 0.875em;
            color: #dc3545;
        }
        
        /* Melhorias para acessibilidade */
        .btn:focus, .form-control:focus, .form-select:focus {
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
            border-color: var(--secondary-color);
        }
        
        /* Animações suaves */
        .fade-in {
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Estilo para mensagens de alerta */
        .alert-custom {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
        }

        /* Status da conexão */
        .connection-status {
            position: fixed;
            bottom: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            z-index: 1000;
        }

        .connection-online {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .connection-offline {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Botões de ação */
        .action-buttons-container {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <!-- Status da Conexão -->
    <div id="connectionStatus" class="connection-status" style="display: none;">
        <i class="fas fa-circle me-1"></i>
        <span id="connectionText">Conectando...</span>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center" style="background: rgba(0,0,0,0.5); z-index: 9999; display: none;">
        <div class="bg-white rounded p-4 text-center">
            <div class="spinner-border text-primary mb-3"></div>
            <p class="mb-0" id="loadingMessage">Processando...</p>
        </div>
    </div>

    <!-- Tela de Login -->
    <div id="loginScreen" class="container">
        <div class="login-container">
            <div class="hospital-header text-center mb-4">
                <h2><i class="fas fa-hospital-alt me-2"></i>SAME</h2>
                <p class="mb-0">HOSP. DE URGÊNCIA DE GOIÁS</p>
            </div>
            <div class="alert alert-info mb-3">
                <small>
                    <i class="fas fa-info-circle me-1"></i>
                    Sistema integrado com Google Sheets. Os dados serão sincronizados automaticamente.
                </small>
            </div>
            <form id="loginForm">
                <div class="mb-3">
                    <label for="loginUser" class="form-label">Usuário</label>
                    <input type="text" class="form-control" id="loginUser" required>
                </div>
                <div class="mb-3">
                    <label for="loginPassword" class="form-label">Senha</label>
                    <input type="password" class="form-control" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary w-100">Entrar</button>
            </form>
            <button type="button" onclick="testarIntegracaoGoogleSheets()" class="btn btn-outline-info w-100 mt-2">
                <i class="fas fa-vial"></i> Testar Conexão Google Sheets
            </button>
        </div>
    </div>

    <!-- Sistema Principal (inicialmente oculto) -->
    <div id="mainSystem" class="container-fluid" style="display: none;">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar">
                <div class="d-flex flex-column align-items-center align-items-sm-start px-3 pt-4">
                    <div class="text-center w-100 mb-4">
                        <h5><i class="fas fa-hospital-alt me-2"></i>SAME</h5>
                        <small>HOSP. DE URGÊNCIA DE GOIÁS</small>
                    </div>
                    <ul class="nav nav-pills flex-column mb-sm-auto mb-0 align-items-center align-items-sm-start w-100" id="menu">
                        <!-- Menu do Usuário -->
                        <div id="userMenu">
                            <li class="nav-item w-100">
                                <a href="#formulario" class="nav-link active" data-bs-toggle="tab">
                                    <i class="fas fa-edit"></i> Formulário
                                </a>
                            </li>
                            <li class="nav-item w-100">
                                <a href="#acompanhamento" class="nav-link" data-bs-toggle="tab">
                                    <i class="fas fa-search"></i> Acompanhamento
                                </a>
                            </li>
                            <li class="nav-item w-100">
                                <a href="#todosRegistros" class="nav-link" data-bs-toggle="tab">
                                    <i class="fas fa-list"></i> Todos os Registros
                                </a>
                            </li>
                            <li class="nav-item w-100">
                                <a href="#" class="nav-link" id="logoutBtn">
                                    <i class="fas fa-sign-out-alt"></i> Sair
                                </a>
                            </li>
                        </div>
                        
                        <!-- Menu do Administrador -->
                        <div id="adminMenu" style="display: none;">
                            <li class="nav-item w-100">
                                <a href="#cadastroUsuario" class="nav-link" data-bs-toggle="tab">
                                    <i class="fas fa-user-plus"></i> Cadastro de Usuário
                                </a>
                            </li>
                            <li class="nav-item w-100">
                                <a href="#cadastroOpcoes" class="nav-link" data-bs-toggle="tab">
                                    <i class="fas fa-cog"></i> Cadastrar Opções
                                </a>
                            </li>
                            <li class="nav-item w-100">
                                <a href="#relatorio" class="nav-link" data-bs-toggle="tab">
                                    <i class="fas fa-chart-bar"></i> Relatório
                                </a>
                            </li>
                            <li class="nav-item w-100">
                                <a href="#historicoUsuario" class="nav-link" data-bs-toggle="tab">
                                    <i class="fas fa-history"></i> Histórico do Usuário
                                </a>
                            </li>
                            <li class="nav-item w-100">
                                <a href="#" class="nav-link" id="adminLogoutBtn">
                                    <i class="fas fa-sign-out-alt"></i> Sair
                                </a>
                            </li>
                        </div>
                    </ul>
                </div>
            </div>

            <!-- Conteúdo Principal -->
            <div class="col-md-10 main-content">
                <!-- Botões de Ação -->
                <div class="action-buttons-container">
                    <div class="btn-group">
                        <button class="btn btn-outline-info btn-sm" onclick="sincronizarDadosComBackup()">
                            <i class="fas fa-sync"></i> Sincronizar
                        </button>
                        <button class="btn btn-outline-warning btn-sm" onclick="mostrarRelatorioSincronizacao()">
                            <i class="fas fa-chart-bar"></i> Relatório Sync
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="sistemaLogs.exportarLogs()">
                            <i class="fas fa-download"></i> Exportar Logs
                        </button>
                        <button class="btn btn-outline-success btn-sm" onclick="fazerBackupLocal()">
                            <i class="fas fa-save"></i> Backup Local
                        </button>
                        <button class="btn btn-outline-primary btn-sm" onclick="testarIntegracaoGoogleSheets()">
                            <i class="fas fa-vial"></i> Testar Conexão
                        </button>
                    </div>
                </div>

                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 id="pageTitle">Formulário de Solicitação</h3>
                    <div class="d-flex align-items-center">
                        <span id="userInfo" class="me-3"></span>
                        <div class="btn-group">
                            <button type="button" class="btn btn-outline-primary btn-sm" id="helpBtn">
                                <i class="fas fa-question-circle"></i> Ajuda
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Conteúdo das Abas -->
                <div class="tab-content">
                    <!-- Aba 1: Formulário de Solicitação -->
                    <div class="tab-pane fade show active" id="formulario">
                        <form id="solicitacaoForm">
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <h5 class="mb-3" style="color: var(--primary-color);">Informações da Solicitação</h5>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="ano" class="form-label">Ano</label>
                                            <input type="text" class="form-control auto-field" id="ano" readonly>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="mes" class="form-label">Mês</label>
                                            <input type="text" class="form-control auto-field" id="mes" readonly>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="dataSolicitacao" class="form-label">Data da Solicitação</label>
                                        <input type="date" class="form-control" id="dataSolicitacao" required>
                                        <div class="invalid-feedback">Por favor, informe a data da solicitação.</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="canalSolicitacao" class="form-label">Canal de Solicitação</label>
                                        <select class="form-select" id="canalSolicitacao" required>
                                            <option value="">Selecione...</option>
                                        </select>
                                        <div class="invalid-feedback">Por favor, selecione o canal de solicitação.</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="motivo" class="form-label">Motivo</label>
                                        <select class="form-select" id="motivo" required>
                                            <option value="">Selecione...</option>
                                        </select>
                                        <div class="invalid-feedback">Por favor, selecione o motivo.</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="docSolicitado" class="form-label">Doc. Solicitado</label>
                                        <select class="form-select" id="docSolicitado" required>
                                            <option value="">Selecione...</option>
                                        </select>
                                        <div class="invalid-feedback">Por favor, selecione o documento solicitado.</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Período Solicitado</label>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <input type="date" class="form-control" id="periodoInicial" required>
                                                <div class="invalid-feedback">Por favor, informe a data inicial.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <input type="date" class="form-control" id="periodoFinal" required>
                                                <div class="invalid-feedback">Por favor, informe a data final.</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <h5 class="mb-3" style="color: var(--primary-color);">Informações do Paciente</h5>
                                    
                                    <div class="mb-3">
                                        <label for="nomePaciente" class="form-label">Nome do Paciente</label>
                                        <input type="text" class="form-control" id="nomePaciente" required>
                                        <div class="invalid-feedback">Por favor, informe o nome do paciente.</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="nomeMae" class="form-label">Nome da Mãe</label>
                                        <input type="text" class="form-control" id="nomeMae" required>
                                        <div class="invalid-feedback">Por favor, informe o nome da mãe.</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="dataNascimento" class="form-label">Data de Nascimento</label>
                                        <input type="date" class="form-control" id="dataNascimento" required>
                                        <div class="invalid-feedback">Por favor, informe a data de nascimento.</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="telefone" class="form-label">Telefone de Contato</label>
                                        <input type="tel" class="form-control" id="telefone" required>
                                        <div class="invalid-feedback">Por favor, informe o telefone de contato.</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="requerente" class="form-label">Requerente</label>
                                        <input type="text" class="form-control" id="requerente" required>
                                        <div class="invalid-feedback">Por favor, informe o requerente.</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="formaRetirada" class="form-label">Forma de Retirada</label>
                                        <select class="form-select" id="formaRetirada" required>
                                            <option value="">Selecione...</option>
                                        </select>
                                        <div class="invalid-feedback">Por favor, selecione a forma de retirada.</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="email" class="form-label">E-mail</label>
                                        <input type="email" class="form-control" id="email">
                                        <div class="invalid-feedback">Por favor, informe um e-mail válido.</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="statusSolicitacao" class="form-label">Status da Solicitação</label>
                                        <select class="form-select" id="statusSolicitacao" required>
                                            <option value="">Selecione...</option>
                                        </select>
                                        <div class="invalid-feedback">Por favor, selecione o status da solicitação.</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="dataRetirada" class="form-label">Data da Retirada</label>
                                        <input type="date" class="form-control" id="dataRetirada">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="observacao" class="form-label">Observação</label>
                                        <textarea class="form-control" id="observacao" rows="3"></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-end">
                                <button type="reset" class="btn btn-outline-secondary me-2">Limpar</button>
                                <button type="submit" class="btn btn-primary">Salvar Solicitação</button>
                            </div>
                        </form>
                    </div>

                    <!-- As outras abas permanecem exatamente iguais -->
                    <!-- Aba 2: Acompanhamento -->
                    <div class="tab-pane fade" id="acompanhamento">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Filtros de Pesquisa</h5>
                            </div>
                            <div class="card-body">
                                <form id="filtroForm">
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label for="filtroData" class="form-label">Data da Solicitação</label>
                                            <input type="date" class="form-control" id="filtroData">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="filtroNome" class="form-label">Nome do Paciente</label>
                                            <input type="text" class="form-control" id="filtroNome">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="filtroStatus" class="form-label">Status</label>
                                            <select class="form-select" id="filtroStatus">
                                                <option value="">Todos os status</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label for="filtroMotivo" class="form-label">Motivo</label>
                                            <select class="form-select" id="filtroMotivo">
                                                <option value="">Todos os motivos</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="filtroCanal" class="form-label">Canal de Solicitação</label>
                                            <select class="form-select" id="filtroCanal">
                                                <option value="">Todos os canais</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="filtroDoc" class="form-label">Documento Solicitado</label>
                                            <select class="form-select" id="filtroDoc">
                                                <option value="">Todos os documentos</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-end">
                                        <button type="submit" class="btn btn-primary">Pesquisar</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Resultados da Pesquisa</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>Data Solicitação</th>
                                                <th>Nome do Paciente</th>
                                                <th>Nome da Mãe</th>
                                                <th>Motivo</th>
                                                <th>Status</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="resultadosTabela">
                                            <!-- Os resultados serão preenchidos via JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba 3: Todos os Registros (Usuário) -->
                    <div class="tab-pane fade" id="todosRegistros">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Todos os Registros</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Data Solicitação</th>
                                                <th>Nome do Paciente</th>
                                                <th>Nome da Mãe</th>
                                                <th>Motivo</th>
                                                <th>Status</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="todosRegistrosTabela">
                                            <!-- Os registros serão preenchidos via JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba 4: Cadastro de Usuário (Admin) -->
                    <div class="tab-pane fade" id="cadastroUsuario">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Cadastro de Novo Usuário</h5>
                            </div>
                            <div class="card-body">
                                <form id="cadastroUsuarioForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="nomeCompleto" class="form-label">Nome Completo</label>
                                            <input type="text" class="form-control" id="nomeCompleto" required>
                                            <div class="invalid-feedback">Por favor, informe o nome completo.</div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="novoUsuario" class="form-label">Usuário</label>
                                            <input type="text" class="form-control" id="novoUsuario" required>
                                            <div class="invalid-feedback">Por favor, informe o nome de usuário.</div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="novaSenha" class="form-label">Senha</label>
                                            <input type="password" class="form-control" id="novaSenha" required>
                                            <div class="invalid-feedback">Por favor, informe a senha.</div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="confirmarSenha" class="form-label">Confirmar Senha</label>
                                            <input type="password" class="form-control" id="confirmarSenha" required>
                                            <div class="invalid-feedback">Por favor, confirme a senha.</div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="novoEmail" class="form-label">E-mail</label>
                                        <input type="email" class="form-control" id="novoEmail" required>
                                        <div class="invalid-feedback">Por favor, informe um e-mail válido.</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="tipoUsuario" class="form-label">Tipo de Usuário</label>
                                        <select class="form-select" id="tipoUsuario" required>
                                            <option value="user">Usuário Comum</option>
                                            <option value="admin">Administrador</option>
                                        </select>
                                    </div>
                                    <div class="d-flex justify-content-end">
                                        <button type="submit" class="btn btn-primary">Cadastrar Usuário</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Usuários Cadastrados</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>Nome Completo</th>
                                                <th>Usuário</th>
                                                <th>E-mail</th>
                                                <th>Tipo</th>
                                                <th>Data de Cadastro</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabelaUsuarios">
                                            <!-- Os usuários serão preenchidos via JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba 5: Cadastrar Opções (Admin) -->
                    <div class="tab-pane fade" id="cadastroOpcoes">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Cadastrar Novas Opções</h5>
                            </div>
                            <div class="card-body">
                                <form id="cadastroOpcoesForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="campoOpcao" class="form-label">Campo</label>
                                            <select class="form-select" id="campoOpcao" required>
                                                <option value="">Selecione o campo...</option>
                                                <option value="canalSolicitacao">Canal de Solicitação</option>
                                                <option value="motivo">Motivo</option>
                                                <option value="docSolicitado">Doc. Solicitado</option>
                                                <option value="formaRetirada">Forma de Retirada</option>
                                                <option value="statusSolicitacao">Status da Solicitação</option>
                                            </select>
                                            <div class="invalid-feedback">Por favor, selecione o campo.</div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="novaOpcao" class="form-label">Nova Opção</label>
                                            <input type="text" class="form-control" id="novaOpcao" required>
                                            <div class="invalid-feedback">Por favor, informe a nova opção.</div>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-end">
                                        <button type="submit" class="btn btn-primary">Adicionar Opção</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Opções Cadastradas</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <h6>Canal de Solicitação</h6>
                                        <ul class="list-group" id="listaCanalSolicitacao">
                                        </ul>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <h6>Motivo</h6>
                                        <ul class="list-group" id="listaMotivo">
                                        </ul>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <h6>Doc. Solicitado</h6>
                                        <ul class="list-group" id="listaDocSolicitado">
                                        </ul>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <h6>Forma de Retirada</h6>
                                        <ul class="list-group" id="listaFormaRetirada">
                                        </ul>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <h6>Status da Solicitação</h6>
                                        <ul class="list-group" id="listaStatusSolicitacao">
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba 6: Relatório (Admin) -->
                    <div class="tab-pane fade" id="relatorio">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Filtros do Relatório</h5>
                            </div>
                            <div class="card-body">
                                <form id="filtroRelatorioForm">
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label for="relatorioAno" class="form-label">Ano</label>
                                            <select class="form-select" id="relatorioAno">
                                                <option value="">Todos os anos</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="relatorioMes" class="form-label">Mês</label>
                                            <select class="form-select" id="relatorioMes">
                                                <option value="">Todos os meses</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="relatorioData" class="form-label">Data de Solicitação</label>
                                            <input type="date" class="form-control" id="relatorioData">
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <button type="submit" class="btn btn-primary">Gerar Relatório</button>
                                        <button type="button" class="btn btn-success" id="gerarPDFBtn">
                                            <i class="fas fa-file-pdf"></i> Gerar PDF
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Métricas Principais -->
                        <div class="row mt-4">
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <i class="fas fa-file-medical"></i>
                                    <h3 id="totalSolicitacoes">0</h3>
                                    <p>Total de Solicitações</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <i class="fas fa-check-circle"></i>
                                    <h3 id="solicitacoesFinalizadas">0</h3>
                                    <p>Solicitações Finalizadas</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <i class="fas fa-clock"></i>
                                    <h3 id="solicitacoesPendentes">0</h3>
                                    <p>Solicitações Pendentes</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <i class="fas fa-chart-line"></i>
                                    <h3 id="taxaConclusao">0%</h3>
                                    <p>Taxa de Conclusão</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Gráficos Detalhados -->
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Solicitações por Motivo</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="motivoChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Solicitações por Status</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="statusChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Documentos Solicitados</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="documentosChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Formas de Retirada</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="retiradaChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Produtividade por Usuário</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="produtividadeChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Evolução Mensal de Solicitações</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="evolucaoChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tabela Detalhada -->
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Detalhamento por Categoria</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Categoria</th>
                                                        <th>Valor</th>
                                                        <th>Quantidade</th>
                                                        <th>Percentual</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="detalhamentoTabela">
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba 7: Histórico do Usuário (Admin) -->
                    <div class="tab-pane fade" id="historicoUsuario">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Selecionar Usuário</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="usuarioHistorico" class="form-label">Usuário</label>
                                        <select class="form-select" id="usuarioHistorico">
                                            <option value="">Selecione um usuário...</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="periodoHistorico" class="form-label">Período</label>
                                        <select class="form-select" id="periodoHistorico">
                                            <option value="7">Últimos 7 dias</option>
                                            <option value="30">Últimos 30 dias</option>
                                            <option value="90">Últimos 3 meses</option>
                                            <option value="365">Último ano</option>
                                            <option value="custom">Personalizado</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row" id="customPeriodo" style="display: none;">
                                    <div class="col-md-6 mb-3">
                                        <label for="dataInicioHistorico" class="form-label">Data de Início</label>
                                        <input type="date" class="form-control" id="dataInicioHistorico">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="dataFimHistorico" class="form-label">Data de Fim</label>
                                        <input type="date" class="form-control" id="dataFimHistorico">
                                    </div>
                                </div>
                                <div class="d-flex justify-content-end">
                                    <button type="button" class="btn btn-primary" id="gerarHistoricoBtn">Gerar Histórico</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-4">
                                <div class="card dashboard-card">
                                    <i class="fas fa-clock"></i>
                                    <h3 id="tempoUso">0h</h3>
                                    <p>Tempo de Uso</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card dashboard-card">
                                    <i class="fas fa-tasks"></i>
                                    <h3 id="solicitacoesUsuario">0</h3>
                                    <p>Solicitações Realizadas</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card dashboard-card">
                                    <i class="fas fa-chart-line"></i>
                                    <h3 id="mediaProdutividade">0/dia</h3>
                                    <p>Média de Produtividade</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mt-4">
                            <div class="card-header">
                                <h5 class="mb-0">Atividades do Usuário</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>Data/Hora</th>
                                                <th>Ação</th>
                                                <th>Detalhes</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabelaAtividades">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Solicitação -->
    <div class="modal fade" id="editarSolicitacaoModal" tabindex="-1" aria-labelledby="editarSolicitacaoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editarSolicitacaoModalLabel">Editar Solicitação</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editarSolicitacaoForm">
                        <input type="hidden" id="editarId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editarStatusSolicitacao" class="form-label">Status da Solicitação</label>
                                    <select class="form-select" id="editarStatusSolicitacao" required>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editarDataRetirada" class="form-label">Data da Retirada</label>
                                    <input type="date" class="form-control" id="editarDataRetirada">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editarObservacao" class="form-label">Observação</label>
                            <textarea class="form-control" id="editarObservacao" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="salvarEdicaoSolicitacao">Salvar Alterações</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // =============================================
        // CONFIGURAÇÕES DO GOOGLE SHEETS
        // =============================================
        const SPREADSHEET_ID = '1OEqh24L8mtMYkf1j8bAn7Q1GZjPqUrUNuY_ySau_5p4'; // Substitua pelo ID da sua planilha
        const API_KEY = 'AIzaSyB9TcVJoCR2A2AICG9oH7owHn2bMiBmhlM'; // Substitua pela sua API Key
        let gapiInicializado = false;
        let ultimaSincronizacao = null;

        // =============================================
        // SISTEMA DE LOGS
        // =============================================
        const sistemaLogs = {
            logs: [],
            
            adicionarLog: function(acao, detalhes, tipo = 'info') {
                const log = {
                    timestamp: new Date().toISOString(),
                    usuario: usuarioLogado ? usuarioLogado.usuario : 'Sistema',
                    acao,
                    detalhes,
                    tipo
                };
                
                this.logs.push(log);
                console.log(`[${tipo.toUpperCase()}] ${acao}: ${detalhes}`);
                
                // Manter apenas os últimos 100 logs
                if (this.logs.length > 100) {
                    this.logs.shift();
                }
                
                // Salvar logs no localStorage
                this.salvarLogsLocal();
            },
            
            salvarLogsLocal: function() {
                try {
                    localStorage.setItem('logs_same', JSON.stringify(this.logs));
                } catch (error) {
                    console.error('Erro ao salvar logs:', error);
                }
            },
            
            carregarLogsLocal: function() {
                try {
                    const logsSalvos = localStorage.getItem('logs_same');
                    if (logsSalvos) {
                        this.logs = JSON.parse(logsSalvos);
                    }
                } catch (error) {
                    console.error('Erro ao carregar logs:', error);
                }
            },
            
            exportarLogs: function() {
                const dataStr = JSON.stringify(this.logs, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `logs_same_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                this.adicionarLog('EXPORTAR_LOGS', 'Logs exportados com sucesso', 'info');
                mostrarMensagem('Logs exportados com sucesso!', 'success');
            },
            
            limparLogs: function() {
                if (confirm('Tem certeza que deseja limpar todos os logs?')) {
                    this.logs = [];
                    localStorage.removeItem('logs_same');
                    this.adicionarLog('LIMPAR_LOGS', 'Todos os logs foram limpos', 'warning');
                    mostrarMensagem('Logs limpos com sucesso!', 'success');
                }
            }
        };

        // =============================================
        // CACHE DE DADOS
        // =============================================
        let cacheDados = {
            solicitacoes: null,
            usuarios: null,
            timestamp: null
        };

        // =============================================
        // DADOS INICIAIS
        // =============================================
        let usuarios = [
            { id: 1, nomeCompleto: "Administrador", usuario: "admin", senha: "admin123", email: "admin@sistema.com", tipo: "admin", dataCadastro: "2023-01-01" },
            { id: 2, nomeCompleto: "João Silva", usuario: "joao.silva", senha: "123456", email: "joao.silva@hospital.com", tipo: "user", dataCadastro: "2023-02-15" },
            { id: 3, nomeCompleto: "Maria Santos", usuario: "maria.santos", senha: "123456", email: "maria.santos@hospital.com", tipo: "user", dataCadastro: "2023-03-10" }
        ];
        
        let opcoesCadastro = {
            canalSolicitacao: ["SITE", "PRESENCIAL"],
            motivo: ["INSS", "DPVAT", "JUDICIAL", "SEGURADORA", "DPVAT / INSS", "2° OPINIÃO", "ÓBITO"],
            docSolicitado: ["COP", "COP + RM", "RM"],
            formaRetirada: ["E-MAIL", "FÍSICO"],
            statusSolicitacao: ["JÁ SOLICITADO", "BAIXANDO", "IMPRIMIR", "ENTREGUE", "NADA CONSTA", "AGUARDANDO RELATÓRIO", "FINALIZADO", "AG. PA ARQUIVO", "AG.JADOC"]
        };
        
        let solicitacoes = [
            {
                id: 1,
                ano: "2023",
                mes: "MAIO",
                dataSolicitacao: "2023-05-10",
                nomePaciente: "Maria Oliveira",
                nomeMae: "Ana Oliveira",
                dataNascimento: "1985-03-15",
                telefone: "(11) 99999-9999",
                canalSolicitacao: "SITE",
                motivo: "INSS",
                docSolicitado: "COP",
                periodoInicial: "2023-01-01",
                periodoFinal: "2023-05-10",
                requerente: "Maria Oliveira",
                formaRetirada: "E-MAIL",
                email: "maria.oliveira@email.com",
                statusSolicitacao: "FINALIZADO",
                dataRetirada: "2023-05-15",
                observacao: "Solicitação processada com sucesso.",
                loginUsuario: "joao.silva"
            }
        ];
        
        let atividadesUsuario = [
            { id: 1, usuario: "joao.silva", dataHora: "2023-05-10 09:15:00", acao: "Cadastro de Solicitação", detalhes: "Solicitação #001 para Maria Oliveira" }
        ];
        
        // Variáveis globais
        let usuarioLogado = null;
        let tipoUsuario = null;

        // =============================================
        // FUNÇÕES DE LOADING
        // =============================================
        function mostrarLoading(mensagem = 'Processando...') {
            document.getElementById('loadingMessage').textContent = mensagem;
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function esconderLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // =============================================
        // FUNÇÕES DE BACKUP LOCAL
        // =============================================
        function fazerBackupLocal() {
            try {
                const backup = {
                    usuarios: usuarios,
                    solicitacoes: solicitacoes,
                    opcoesCadastro: opcoesCadastro,
                    atividadesUsuario: atividadesUsuario,
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('backup_same', JSON.stringify(backup));
                
                sistemaLogs.adicionarLog('BACKUP_LOCAL', 'Backup local realizado com sucesso', 'success');
                mostrarMensagem(`✅ Backup local realizado! (${new Date().toLocaleString()})`, 'success');
                
                return true;
            } catch (error) {
                sistemaLogs.adicionarLog('ERRO_BACKUP', `Erro ao fazer backup: ${error.message}`, 'error');
                mostrarMensagem('❌ Erro ao fazer backup local', 'error');
                return false;
            }
        }

        function recuperarBackupLocal() {
            try {
                const backup = localStorage.getItem('backup_same');
                if (backup) {
                    const dados = JSON.parse(backup);
                    usuarios = dados.usuarios || usuarios;
                    solicitacoes = dados.solicitacoes || solicitacoes;
                    opcoesCadastro = dados.opcoesCadastro || opcoesCadastro;
                    atividadesUsuario = dados.atividadesUsuario || atividadesUsuario;
                    
                    sistemaLogs.adicionarLog('RESTAURAR_BACKUP', `Backup recuperado (${new Date(dados.timestamp).toLocaleString()})`, 'success');
                    mostrarMensagem(`✅ Backup recuperado! (${new Date(dados.timestamp).toLocaleString()})`, 'success');
                    
                    // Atualizar interface
                    preencherTodosRegistros();
                    atualizarTabelaUsuarios();
                    preencherListasOpcoes();
                    
                    return true;
                } else {
                    mostrarMensagem('❌ Nenhum backup local encontrado', 'warning');
                    return false;
                }
            } catch (error) {
                sistemaLogs.adicionarLog('ERRO_RESTAURAR', `Erro ao restaurar backup: ${error.message}`, 'error');
                mostrarMensagem('❌ Erro ao restaurar backup', 'error');
                return false;
            }
        }

        // =============================================
        // FUNÇÕES DO GOOGLE SHEETS
        // =============================================

        // Inicializar Google API
        async function inicializarGoogleAPI() {
            try {
                mostrarLoading('Inicializando Google Sheets API...');
                
                await new Promise((resolve, reject) => {
                    gapi.load('client', { callback: resolve, onerror: reject });
                });
                
                await gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
                });
                
                gapiInicializado = true;
                atualizarStatusConexao(true);
                
                sistemaLogs.adicionarLog('INICIALIZAR_API', 'Google Sheets API inicializada com sucesso', 'success');
                console.log('Google API inicializada com sucesso');
                
                // Tentar carregar dados do Google Sheets
                await carregarDadosSheetsComCache();
                
            } catch (error) {
                console.error('Erro ao inicializar Google API:', error);
                atualizarStatusConexao(false);
                
                sistemaLogs.adicionarLog('ERRO_INICIALIZAR_API', `Erro: ${error.message}`, 'error');
                mostrarMensagem('❌ Erro ao conectar com Google Sheets. Usando dados locais.', 'error');
            } finally {
                esconderLoading();
            }
        }

        // Carregar dados do Google Sheets com cache
        async function carregarDadosSheetsComCache() {
            const agora = new Date();
            const cacheValido = cacheDados.timestamp && (agora - new Date(cacheDados.timestamp)) < 300000; // 5 minutos
            
            if (cacheValido && cacheDados.solicitacoes) {
                console.log('Usando dados em cache');
                solicitacoes = cacheDados.solicitacoes;
                usuarios = cacheDados.usuarios;
                return;
            }
            
            await carregarDadosSheets();
            
            // Atualizar cache
            cacheDados = {
                solicitacoes: [...solicitacoes],
                usuarios: [...usuarios],
                timestamp: new Date().toISOString()
            };
        }

        // Carregar dados do Google Sheets
        async function carregarDadosSheets() {
            if (!gapiInicializado) return;

            try {
                sistemaLogs.adicionarLog('CARREGAR_DADOS', 'Iniciando carregamento de dados do Sheets', 'info');

                // Carregar solicitações
                const responseSolicitacoes = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Solicitacoes!A2:T',
                });

                if (responseSolicitacoes.result.values) {
                    solicitacoes = responseSolicitacoes.result.values.map(row => ({
                        id: parseInt(row[0]) || 0,
                        ano: row[1] || '',
                        mes: row[2] || '',
                        dataSolicitacao: row[3] || '',
                        nomePaciente: row[4] || '',
                        nomeMae: row[5] || '',
                        dataNascimento: row[6] || '',
                        telefone: row[7] || '',
                        canalSolicitacao: row[8] || '',
                        motivo: row[9] || '',
                        docSolicitado: row[10] || '',
                        periodoInicial: row[11] || '',
                        periodoFinal: row[12] || '',
                        requerente: row[13] || '',
                        formaRetirada: row[14] || '',
                        email: row[15] || '',
                        statusSolicitacao: row[16] || '',
                        dataRetirada: row[17] || '',
                        observacao: row[18] || '',
                        loginUsuario: row[19] || ''
                    })).filter(s => s.id > 0);
                }

                // Carregar usuários
                const responseUsuarios = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Usuarios!A2:G',
                });

                if (responseUsuarios.result.values) {
                    usuarios = responseUsuarios.result.values.map(row => ({
                        id: parseInt(row[0]) || 0,
                        nomeCompleto: row[1] || '',
                        usuario: row[2] || '',
                        senha: row[3] || '',
                        email: row[4] || '',
                        tipo: row[5] || 'user',
                        dataCadastro: row[6] || ''
                    })).filter(u => u.id > 0);
                }

                sistemaLogs.adicionarLog('CARREGAR_DADOS', `Carregados ${solicitacoes.length} solicitações e ${usuarios.length} usuários`, 'success');
                console.log('Dados carregados do Google Sheets');
                
            } catch (error) {
                console.error('Erro ao carregar dados do Sheets:', error);
                sistemaLogs.adicionarLog('ERRO_CARREGAR_DADOS', `Erro: ${error.message}`, 'error');
            }
        }

        // Salvar solicitação no Google Sheets
        async function salvarSolicitacaoSheets(solicitacao) {
            if (!gapiInicializado) return false;

            try {
                // Validar dados antes de salvar
                const errosValidacao = validarDadosSolicitacao(solicitacao);
                if (errosValidacao.length > 0) {
                    sistemaLogs.adicionarLog('VALIDACAO_SOLICITACAO', `Erros: ${errosValidacao.join(', ')}`, 'error');
                    return false;
                }

                const values = [
                    [
                        solicitacao.id.toString(),
                        solicitacao.ano,
                        solicitacao.mes,
                        solicitacao.dataSolicitacao,
                        solicitacao.nomePaciente,
                        solicitacao.nomeMae,
                        solicitacao.dataNascimento,
                        solicitacao.telefone,
                        solicitacao.canalSolicitacao,
                        solicitacao.motivo,
                        solicitacao.docSolicitado,
                        solicitacao.periodoInicial,
                        solicitacao.periodoFinal,
                        solicitacao.requerente,
                        solicitacao.formaRetirada,
                        solicitacao.email,
                        solicitacao.statusSolicitacao,
                        solicitacao.dataRetirada,
                        solicitacao.observacao,
                        solicitacao.loginUsuario
                    ]
                ];

                const response = await gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Solicitacoes!A1',
                    valueInputOption: 'RAW',
                    insertDataOption: 'INSERT_ROWS',
                    resource: { values }
                });

                sistemaLogs.adicionarLog('SALVAR_SOLICITACAO', `Solicitação #${solicitacao.id} salva no Sheets`, 'success');
                console.log('Solicitação salva no Sheets:', response);
                return true;
            } catch (error) {
                console.error('Erro ao salvar solicitação no Sheets:', error);
                sistemaLogs.adicionarLog('ERRO_SALVAR_SOLICITACAO', `Erro: ${error.message}`, 'error');
                return false;
            }
        }

        // Atualizar solicitação no Google Sheets
        async function atualizarSolicitacaoSheets(solicitacao) {
            if (!gapiInicializado) return false;

            try {
                // Encontrar a linha da solicitação
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Solicitacoes!A2:T',
                });

                if (!response.result.values) return false;

                const rows = response.result.values;
                let rowIndex = -1;

                for (let i = 0; i < rows.length; i++) {
                    if (parseInt(rows[i][0]) === solicitacao.id) {
                        rowIndex = i + 2; // +2 porque a linha 1 é cabeçalho
                        break;
                    }
                }

                if (rowIndex === -1) return false;

                const values = [
                    [
                        solicitacao.id.toString(),
                        solicitacao.ano,
                        solicitacao.mes,
                        solicitacao.dataSolicitacao,
                        solicitacao.nomePaciente,
                        solicitacao.nomeMae,
                        solicitacao.dataNascimento,
                        solicitacao.telefone,
                        solicitacao.canalSolicitacao,
                        solicitacao.motivo,
                        solicitacao.docSolicitado,
                        solicitacao.periodoInicial,
                        solicitacao.periodoFinal,
                        solicitacao.requerente,
                        solicitacao.formaRetirada,
                        solicitacao.email,
                        solicitacao.statusSolicitacao,
                        solicitacao.dataRetirada,
                        solicitacao.observacao,
                        solicitacao.loginUsuario
                    ]
                ];

                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: `Solicitacoes!A${rowIndex}:T${rowIndex}`,
                    valueInputOption: 'RAW',
                    resource: { values }
                });

                sistemaLogs.adicionarLog('ATUALIZAR_SOLICITACAO', `Solicitação #${solicitacao.id} atualizada no Sheets`, 'success');
                console.log('Solicitação atualizada no Sheets');
                return true;
            } catch (error) {
                console.error('Erro ao atualizar solicitação no Sheets:', error);
                sistemaLogs.adicionarLog('ERRO_ATUALIZAR_SOLICITACAO', `Erro: ${error.message}`, 'error');
                return false;
            }
        }

        // =============================================
        // FUNÇÕES DE SINCRONIZAÇÃO
        // =============================================

        // Sincronizar dados com backup
        async function sincronizarDadosComBackup() {
            // Fazer backup antes de sincronizar
            fazerBackupLocal();
            await sincronizarDados();
        }

        // Sincronizar dados
        async function sincronizarDados() {
            try {
                mostrarLoading('Sincronizando dados com Google Sheets...');
                
                await carregarDadosSheetsComCache();
                ultimaSincronizacao = new Date();
                
                // Atualizar interface
                preencherTodosRegistros();
                atualizarTabelaUsuarios();
                preencherListasOpcoes();
                
                sistemaLogs.adicionarLog('SINCRONIZAR_DADOS', 'Dados sincronizados com sucesso', 'success');
                mostrarMensagem('✅ Dados sincronizados com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro na sincronização:', error);
                sistemaLogs.adicionarLog('ERRO_SINCRONIZAR', `Erro: ${error.message}`, 'error');
                mostrarMensagem('❌ Erro ao sincronizar dados', 'error');
            } finally {
                esconderLoading();
            }
        }

        // =============================================
        // FUNÇÕES DE VALIDAÇÃO
        // =============================================

        // Validar dados da solicitação
        function validarDadosSolicitacao(solicitacao) {
            const erros = [];
            
            if (!solicitacao.nomePaciente || solicitacao.nomePaciente.trim().length < 3) {
                erros.push('Nome do paciente inválido');
            }
            
            if (!solicitacao.dataSolicitacao) {
                erros.push('Data de solicitação inválida');
            }
            
            if (!solicitacao.nomeMae || solicitacao.nomeMae.trim().length < 3) {
                erros.push('Nome da mãe inválido');
            }
            
            // Validar formato de email se fornecido
            if (solicitacao.email && !validarEmail(solicitacao.email)) {
                erros.push('Email inválido');
            }
            
            // Validar período
            if (solicitacao.periodoInicial && solicitacao.periodoFinal) {
                const dataInicial = new Date(solicitacao.periodoInicial);
                const dataFinal = new Date(solicitacao.periodoFinal);
                if (dataFinal < dataInicial) {
                    erros.push('Período final não pode ser anterior ao período inicial');
                }
            }
            
            return erros;
        }

        // =============================================
        // FUNÇÕES DE RELATÓRIO E STATUS
        // =============================================

        // Atualizar status da conexão
        function atualizarStatusConexao(online) {
            const statusElement = document.getElementById('connectionStatus');
            const textElement = document.getElementById('connectionText');
            
            if (online) {
                statusElement.className = 'connection-status connection-online';
                textElement.textContent = 'Conectado ao Google Sheets';
                statusElement.style.display = 'block';
            } else {
                statusElement.className = 'connection-status connection-offline';
                textElement.textContent = 'Modo Offline - Dados Locais';
                statusElement.style.display = 'block';
            }
        }

        // Gerar relatório de sincronização
        function gerarRelatorioSincronizacao() {
            const relatorio = {
                totalSolicitacoes: solicitacoes.length,
                totalUsuarios: usuarios.length,
                ultimaSincronizacao: ultimaSincronizacao,
                statusConexao: gapiInicializado ? 'Conectado' : 'Desconectado',
                storageLocal: localStorage.getItem('backup_same') ? 'Com backup' : 'Sem backup',
                totalLogs: sistemaLogs.logs.length
            };
            
            return relatorio;
        }

        // Mostrar relatório de sincronização
        function mostrarRelatorioSincronizacao() {
            const relatorio = gerarRelatorioSincronizacao();
            
            const modalHTML = `
                <div class="modal fade" id="relatorioSyncModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">📊 Relatório de Sincronização</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-6"><strong>Status Conexão:</strong></div>
                                    <div class="col-6"><span class="badge ${relatorio.statusConexao === 'Conectado' ? 'bg-success' : 'bg-danger'}">${relatorio.statusConexao}</span></div>
                                    
                                    <div class="col-6"><strong>Última Sinc.:</strong></div>
                                    <div class="col-6">${relatorio.ultimaSincronizacao ? new Date(relatorio.ultimaSincronizacao).toLocaleString() : 'Nunca'}</div>
                                    
                                    <div class="col-6"><strong>Solicitações:</strong></div>
                                    <div class="col-6">${relatorio.totalSolicitacoes}</div>
                                    
                                    <div class="col-6"><strong>Usuários:</strong></div>
                                    <div class="col-6">${relatorio.totalUsuarios}</div>
                                    
                                    <div class="col-6"><strong>Backup Local:</strong></div>
                                    <div class="col-6">${relatorio.storageLocal}</div>
                                    
                                    <div class="col-6"><strong>Logs do Sistema:</strong></div>
                                    <div class="col-6">${relatorio.totalLogs}</div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                                <button type="button" class="btn btn-warning" onclick="sistemaLogs.limparLogs()">Limpar Logs</button>
                                <button type="button" class="btn btn-info" onclick="recuperarBackupLocal()">Restaurar Backup</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remover modal anterior se existir
            const modalAnterior = document.getElementById('relatorioSyncModal');
            if (modalAnterior) modalAnterior.remove();
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            new bootstrap.Modal(document.getElementById('relatorioSyncModal')).show();
        }

        // Testar integração com Google Sheets
        async function testarIntegracaoGoogleSheets() {
            try {
                mostrarLoading('Testando conexão com Google Sheets...');
                
                if (!gapiInicializado) {
                    throw new Error('API não inicializada');
                }
                
                // Testar leitura
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Solicitacoes!A1:T1',
                });
                
                sistemaLogs.adicionarLog('TESTE_CONEXAO', 'Conexão com Google Sheets testada com sucesso', 'success');
                mostrarMensagem('✅ Conexão com Google Sheets funcionando!', 'success');
                
            } catch (error) {
                console.error('Erro no teste:', error);
                sistemaLogs.adicionarLog('ERRO_TESTE_CONEXAO', `Erro: ${error.message}`, 'error');
                mostrarMensagem('❌ Erro na conexão com Google Sheets', 'error');
            } finally {
                esconderLoading();
            }
        }

        // =============================================
        // DEBOUNCE PARA PESQUISAS
        // =============================================
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // =============================================
        // INICIALIZAÇÃO DA APLICAÇÃO
        // =============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Carregar logs do sistema
            sistemaLogs.carregarLogsLocal();
            sistemaLogs.adicionarLog('SISTEMA_INICIADO', 'Sistema SAME inicializado', 'info');
            
            // Inicializar Google API
            inicializarGoogleAPI();
            
            // Configurar data atual para campos de data
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataSolicitacao').value = hoje;
            document.getElementById('periodoInicial').value = hoje;
            document.getElementById('periodoFinal').value = hoje;
            
            // Preencher ano e mês automaticamente
            atualizarAnoMes();
            
            // Preencher anos no relatório (2020 a 2040)
            const relatorioAnoSelect = document.getElementById('relatorioAno');
            for (let i = 2020; i <= 2040; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                relatorioAnoSelect.appendChild(option);
            }
            
            // Preencher meses no relatório
            const meses = [
                "JANEIRO", "FEVEREIRO", "MARÇO", "ABRIL", "MAIO", "JUNHO",
                "JULHO", "AGOSTO", "SETEMBRO", "OUTUBRO", "NOVEMBRO", "DEZEMBRO"
            ];
            
            const relatorioMesSelect = document.getElementById('relatorioMes');
            meses.forEach(mes => {
                const option = document.createElement('option');
                option.value = mes;
                option.textContent = mes;
                relatorioMesSelect.appendChild(option);
            });
            
            // Event Listeners
            document.getElementById('loginForm').addEventListener('submit', fazerLogin);
            document.getElementById('logoutBtn').addEventListener('click', fazerLogout);
            document.getElementById('adminLogoutBtn').addEventListener('click', fazerLogout);
            document.getElementById('solicitacaoForm').addEventListener('submit', salvarSolicitacao);
            document.getElementById('filtroForm').addEventListener('submit', pesquisarSolicitacoes);
            document.getElementById('cadastroUsuarioForm').addEventListener('submit', cadastrarUsuario);
            document.getElementById('cadastroOpcoesForm').addEventListener('submit', cadastrarOpcao);
            document.getElementById('filtroRelatorioForm').addEventListener('submit', gerarRelatorio);
            document.getElementById('gerarHistoricoBtn').addEventListener('click', gerarHistoricoUsuario);
            document.getElementById('periodoHistorico').addEventListener('change', function() {
                document.getElementById('customPeriodo').style.display = 
                    this.value === 'custom' ? 'block' : 'none';
            });
            document.getElementById('helpBtn').addEventListener('click', mostrarAjuda);
            document.getElementById('gerarPDFBtn').addEventListener('click', gerarPDF);
            document.getElementById('salvarEdicaoSolicitacao').addEventListener('click', salvarEdicaoSolicitacao);
            
            // Aplicar debounce na pesquisa
            document.getElementById('filtroNome').addEventListener('input', 
                debounce(() => pesquisarSolicitacoes({ preventDefault: () => {} }), 500)
            );
            
            // Preencher listas de opções
            preencherListasOpcoes();
            atualizarSelectsFormulario();
            atualizarSelectsFiltros();
            
            // Preencher usuários no histórico
            preencherUsuariosHistorico();
            
            // Preencher tabela de todos os registros
            preencherTodosRegistros();
            
            // Atualizar tabela de usuários
            atualizarTabelaUsuarios();
            
            // Configurar validação de formulários
            configurarValidacaoFormularios();
            
            // Sincronização automática a cada 5 minutos
            setInterval(async () => {
                if (usuarioLogado && gapiInicializado) {
                    await sincronizarDados();
                }
            }, 300000);
        });

        // =============================================
        // FUNÇÕES PRINCIPAIS DO SISTEMA (MODIFICADAS)
        // =============================================

        // Função para salvar solicitação (MODIFICADA)
        async function salvarSolicitacao(e) {
            e.preventDefault();
            
            if (!validarFormulario(document.getElementById('solicitacaoForm'))) {
                mostrarMensagem('Por favor, preencha todos os campos obrigatórios corretamente.', 'error');
                return;
            }
            
            mostrarLoading('Salvando solicitação...');
            
            try {
                // Coletar dados do formulário
                const novaSolicitacao = {
                    id: solicitacoes.length > 0 ? Math.max(...solicitacoes.map(s => s.id)) + 1 : 1,
                    ano: document.getElementById('ano').value,
                    mes: document.getElementById('mes').value,
                    dataSolicitacao: document.getElementById('dataSolicitacao').value,
                    nomePaciente: document.getElementById('nomePaciente').value,
                    nomeMae: document.getElementById('nomeMae').value,
                    dataNascimento: document.getElementById('dataNascimento').value,
                    telefone: document.getElementById('telefone').value,
                    canalSolicitacao: document.getElementById('canalSolicitacao').value,
                    motivo: document.getElementById('motivo').value,
                    docSolicitado: document.getElementById('docSolicitado').value,
                    periodoInicial: document.getElementById('periodoInicial').value,
                    periodoFinal: document.getElementById('periodoFinal').value,
                    requerente: document.getElementById('requerente').value,
                    formaRetirada: document.getElementById('formaRetirada').value,
                    email: document.getElementById('email').value,
                    statusSolicitacao: document.getElementById('statusSolicitacao').value,
                    dataRetirada: document.getElementById('dataRetirada').value,
                    observacao: document.getElementById('observacao').value,
                    loginUsuario: usuarioLogado.usuario
                };
                
                // Adicionar à lista de solicitações
                solicitacoes.push(novaSolicitacao);
                
                // Salvar no Google Sheets
                const salvoNoSheets = await salvarSolicitacaoSheets(novaSolicitacao);
                
                if (salvoNoSheets) {
                    mostrarMensagem('✅ Solicitação cadastrada e sincronizada com Google Sheets!', 'success');
                } else {
                    mostrarMensagem('⚠️ Solicitação salva localmente (erro ao conectar com Google Sheets).', 'warning');
                }
                
                // Registrar atividade
                const agora = new Date();
                const dataHora = `${agora.toISOString().split('T')[0]} ${agora.toTimeString().split(' ')[0]}`;
                atividadesUsuario.push({
                    id: atividadesUsuario.length + 1,
                    usuario: usuarioLogado.usuario,
                    dataHora: dataHora,
                    acao: "Cadastro de Solicitação",
                    detalhes: `Solicitação #${novaSolicitacao.id} para ${novaSolicitacao.nomePaciente}`
                });
                
                // Limpar formulário
                document.getElementById('solicitacaoForm').reset();
                
                // Definir data atual
                const hoje = new Date().toISOString().split('T')[0];
                document.getElementById('dataSolicitacao').value = hoje;
                document.getElementById('periodoInicial').value = hoje;
                document.getElementById('periodoFinal').value = hoje;
                
                // Atualizar ano e mês
                atualizarAnoMes();
                
                // Atualizar tabela de todos os registros
                preencherTodosRegistros();
                
                // Invalidar cache
                cacheDados.timestamp = null;
                
            } catch (error) {
                console.error('Erro ao salvar solicitação:', error);
                sistemaLogs.adicionarLog('ERRO_SALVAR_SOLICITACAO', `Erro: ${error.message}`, 'error');
                mostrarMensagem('❌ Erro ao salvar solicitação', 'error');
            } finally {
                esconderLoading();
            }
        }

        // Função para salvar edição da solicitação (MODIFICADA)
        async function salvarEdicaoSolicitacao() {
            const id = parseInt(document.getElementById('editarId').value);
            const solicitacaoIndex = solicitacoes.findIndex(s => s.id === id);
            
            if (solicitacaoIndex === -1) return;
            
            mostrarLoading('Atualizando solicitação...');
            
            try {
                // Atualizar dados da solicitação
                solicitacoes[solicitacaoIndex].statusSolicitacao = document.getElementById('editarStatusSolicitacao').value;
                solicitacoes[solicitacaoIndex].dataRetirada = document.getElementById('editarDataRetirada').value;
                solicitacoes[solicitacaoIndex].observacao = document.getElementById('editarObservacao').value;
                
                // Atualizar no Google Sheets
                const atualizadoNoSheets = await atualizarSolicitacaoSheets(solicitacoes[solicitacaoIndex]);
                
                if (atualizadoNoSheets) {
                    mostrarMensagem('✅ Solicitação atualizada e sincronizada com Google Sheets!', 'success');
                } else {
                    mostrarMensagem('⚠️ Alterações salvas localmente (erro ao conectar com Google Sheets).', 'warning');
                }
                
                // Registrar atividade
                const agora = new Date();
                const dataHora = `${agora.toISOString().split('T')[0]} ${agora.toTimeString().split(' ')[0]}`;
                atividadesUsuario.push({
                    id: atividadesUsuario.length + 1,
                    usuario: usuarioLogado.usuario,
                    dataHora: dataHora,
                    acao: "Atualização de Solicitação",
                    detalhes: `Solicitação #${id} atualizada`
                });
                
                // Fechar modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('editarSolicitacaoModal'));
                modal.hide();
                
                // Atualizar tabelas
                pesquisarSolicitacoes({ preventDefault: () => {} });
                preencherTodosRegistros();
                
                // Invalidar cache
                cacheDados.timestamp = null;
                
            } catch (error) {
                console.error('Erro ao atualizar solicitação:', error);
                sistemaLogs.adicionarLog('ERRO_ATUALIZAR_SOLICITACAO', `Erro: ${error.message}`, 'error');
                mostrarMensagem('❌ Erro ao atualizar solicitação', 'error');
            } finally {
                esconderLoading();
            }
        }

        // =============================================
        // FUNÇÕES ORIGINAIS DO SISTEMA (MANTIDAS)
        // =============================================

        // [Todas as outras funções do sistema permanecem aqui...]
        // fazerLogin, fazerLogout, pesquisarSolicitacoes, preencherTodosRegistros,
        // editarSolicitacao, cadastrarUsuario, atualizarTabelaUsuarios, removerUsuario,
        // cadastrarOpcao, removerOpcao, preencherListasOpcoes, atualizarSelectsFormulario,
        // atualizarSelectsFiltros, preencherUsuariosHistorico, gerarHistoricoUsuario,
        // gerarRelatorio, gerarGraficoMotivos, gerarGraficoStatus, gerarGraficoDocumentos,
        // gerarGraficoRetirada, gerarGraficoProdutividade, gerarGraficoEvolucao,
        // preencherTabelaDetalhamento, gerarPDF, filtrarSolicitacoesParaRelatorio,
        // calcularMediaPorDia, calcularTempoMedioAtendimento, calcularUsuarioMaisProdutivo,
        // mostrarAjuda, mostrarMensagem, formatarData, formatarDataHora,
        // configurarValidacaoFormularios, validarFormulario, validarEmail, atualizarAnoMes

        // Por questão de espaço, mantenho apenas as assinaturas das funções principais
        // que precisam ser implementadas conforme o código original

        function fazerLogin(e) {
            e.preventDefault();
            // Implementação original...
        }

        function fazerLogout() {
            // Implementação original...
        }

        function pesquisarSolicitacoes(e) {
            e.preventDefault();
            // Implementação original...
        }

        function preencherTodosRegistros() {
            // Implementação original...
        }

        function editarSolicitacao(id) {
            // Implementação original...
        }

        function cadastrarUsuario(e) {
            e.preventDefault();
            // Implementação original...
        }

        function atualizarTabelaUsuarios() {
            // Implementação original...
        }

        function removerUsuario(id) {
            // Implementação original...
        }

        function cadastrarOpcao(e) {
            e.preventDefault();
            // Implementação original...
        }

        function removerOpcao(campo, opcao) {
            // Implementação original...
        }

        function preencherListasOpcoes() {
            // Implementação original...
        }

        function atualizarSelectsFormulario() {
            // Implementação original...
        }

        function atualizarSelectsFiltros() {
            // Implementação original...
        }

        function preencherUsuariosHistorico() {
            // Implementação original...
        }

        function gerarHistoricoUsuario() {
            // Implementação original...
        }

        function gerarRelatorio(e) {
            if (e) e.preventDefault();
            // Implementação original...
        }

        function gerarGraficoMotivos(solicitacoes) {
            // Implementação original...
        }

        function gerarGraficoStatus(solicitacoes) {
            // Implementação original...
        }

        function gerarGraficoDocumentos(solicitacoes) {
            // Implementação original...
        }

        function gerarGraficoRetirada(solicitacoes) {
            // Implementação original...
        }

        function gerarGraficoProdutividade(solicitacoes) {
            // Implementação original...
        }

        function gerarGraficoEvolucao(solicitacoes) {
            // Implementação original...
        }

        function preencherTabelaDetalhamento(solicitacoes) {
            // Implementação original...
        }

        function gerarPDF() {
            // Implementação original...
        }

        function filtrarSolicitacoesParaRelatorio() {
            // Implementação original...
        }

        function calcularMediaPorDia(solicitacoes) {
            // Implementação original...
        }

        function calcularTempoMedioAtendimento(solicitacoes) {
            // Implementação original...
        }

        function calcularUsuarioMaisProdutivo(solicitacoes) {
            // Implementação original...
        }

        function mostrarAjuda() {
            // Implementação original...
        }

        function mostrarMensagem(mensagem, tipo) {
            // Implementação original...
        }

        function formatarData(data) {
            // Implementação original...
        }

        function formatarDataHora(dataHora) {
            // Implementação original...
        }

        function configurarValidacaoFormularios() {
            // Implementação original...
        }

        function validarFormulario(form) {
            // Implementação original...
        }

        function validarEmail(email) {
            // Implementação original...
        }

        function atualizarAnoMes() {
            // Implementação original...
        }
    </script>
</body>
</html>
